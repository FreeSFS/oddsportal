{% haml %}

#right_side_bar
    %form#searchForm method="post" action="/search_results"
        %br
        .row
            .large-12.text-center.columns
                %h4 -> Selecting by
            .large-12.text-center.columns
                %a#select_by_button.select_league_window -> leagues
                %a#select_by_button.select_teams_window href="#select_teams_box" -> teams
                %br
                %br
                %br
                
        .row#select_by_league_block
            .large-3.columns
                %label.right-inline -> Country
            .large-9.columns
                %select name="league"
                    %option selected="selected" value=""
                    -for league in leagues
                        %option value="{{ league }}" -> {{ league }}
        
            .large-3.columns
                %label -> League
            .large-9.columns
                %select name="group" disabled
                    %option selected="selected" value=""

        .row
            .large-7.text-left.columns
                %br
                %label -> Select year
            .large-5.text-left.columns
                %br
                %label -> Coefficient

            .large-7.text-left.columns#years
                %input#2014 name="year" type="checkbox" value="2014" disabled
                %label
                    2014
                %br
            .large-5.columns#years_coeffs
                %input#coefficient name="year_coeff" type="text" autocomplete='off' disabled

            #mySlideContent
            #mySlideToggler
                %a.show_years href="javascript:void()" -> Show all years
            

        -if logged
            .row
                %br
                .large-12.columns
                    .row.collapse
                        .small-9.columns
                            %select#select_calc_template name="select_template"
                                %option disabled selected -> select a template
                                -for template in calc_templates
                                    %option value={{ template }} -> {{ template }}

                        .small-3.columns
                            %a#button_get.button.postfix disabled onclick="get_template()" -> get
                        
                .large-12.columns
                    .row.collapse
                        .small-9.columns
                            %input.calc_template_name name="template_name" type="text" placeholder="Template name"

                        .small-3.columns
                            %a#button_save.button.postfix disabled onclick="save_calc_template()" -> save
            %a.delete_template onclick="delete_template()" -> Delete template

        .row
            %br
            .large-4.columns
                %label -> Handicap
                    %select#handicap name="handicap"
                        %option value="hda" -> H/D/A
                        %option value="ou" -> O/U

            .large-4.columns
                %label -> Where
                    %select name="form_playing_at_types"
                        %option selected value="h" -> At Home
                        %option value="a" -> Away

            .large-4.columns
                %label -> Strategy
                    %select#strategy name="strategy"
                        %option value="h" -> Home
                        %option value="d" -> Draw
                        %option value="a" -> Away

            .large-4.columns
                %label -> Value
                    %select#ou_values disabled name="ou_values"
                        -for ou_value in ou_values
                            %option value={{ou_value}} -> {{ ou_value }}

            .large-4.columns
                %label -> Game part
                    %select#game_part name="game_part"
                        %option value="full" -> Full
                        %option value="frst" -> 1st Half
                        %option value="scnd" -> 2nd Half

            .large-4.columns
                %label -> Odds type
                    %select#odds_type name="odds_type"
                        %option value="a" -> Average
                        %option value="h" -> Highest


            .large-6.columns
                %br
                %label -> Odds toggle
                    %input.high_input name="odd_toggle" type="text" autocomplete='off'

            .large-6.columns
                %br
                %label#stake
                    %i.fa.fa-usd
                    &nbsp;Stake
                    %input.high_input name="odd_value" type="text" autocomplete='off'

            .large-12.columns
                %label -> Stake varying
                    %select name="varying_type"
                        %option value="0" -> choose option
                        %option value="1" -> by % of new stake 
                        %option value="2" -> by % of init stake

            .large-4.columns
                %label -> Value
                    %input name="varying_value" type="text" autocomplete='off'
            .large-4.columns
                %label -> N_Games
                    %input name="number_of_games" type="text" autocomplete='off'
            .large-4.columns
                %label -> From win
                    %input name="bet_from_win" type="checkbox" value="1"

            .large-12.columns
                %label -> Stop after some number of losses
                    %input name="stop_after" type="text" autocomplete='off'


            %input.selected_teams_hidden name='selected_teams_hidden'
            
            .large-12.columns
                %br
                %input.button.expand disabled type="submit" value="Go"

            .large-12.text-center.columns
                %span#error -> {{error}}
                <br><br><br><br><br>

            
                

    

    #select_teams_box.select_teams_popup
        %a.winter href="#" value='winter' -> WINTER teams
        %a.summer href="#" value='summer' -> SUMMER teams
        %br
        %span.warning -> Warning: switching selector will remove all selected teams
        %a.close onclick="close_selection_team()"
            %i.fa.fa-times
        #select_teams.large-12.large-centered.columns
            %form#select_teams data-bind="submit:addItem"
                %label -> Team name: 
                .large-12.columns
                    .row.collapse
                        .large-9.columns
                            %input#query disabled type="text" disabled data-bind='value:itemToAdd, valueUpdate: "afterkeydown"'
                        .large-3.columns
                            %button#button_team_name.button.postfix disabled type="submit" data-bind="enable: itemToAdd().length > 0" -> Add
            .row
                .large-12.columns
                    .row.collapse
                        .small-9.columns
                            %select#select_teams_template name="select_teams_template"
                                %option disabled selected -> select a template
                                -for template in teams_templates
                                    %option value={{ template }} -> {{ template }}

                        .small-3.columns
                            %a#select_teams_button_get.button.postfix disabled onclick="get_team_template()" -> get
                        
                .large-12.columns
                    .row.collapse
                        .small-9.columns
                            %input.teams_template_name name="teams_template_name" type="text" placeholder="Template name"

                        .small-3.columns
                            %a#select_teams_button_save.button.postfix disabled onclick="save_teams_template()" -> save
                
             
            %label -> Selected teams:
            %select.selected_teams multiple="multiple" height="15" data-bind="options:allItems, selectedOptions:selectedItems"
             
            %div
                %button data-bind="click: removeSelected, enable: selectedItems().length > 0" -> Remove
                &nbsp;
                %button data-bind="click: sortItems, enable: allItems().length > 1" -> Sort
                %a.reset_all data-bind="click: removeAllItems, enable: allItems().length > 1" -> reset all
                


%script
    $(document).ready(function() {
        $('#select_by_league_block').css('display', 'none');
    });
    $('a.select_league_window').on('click', function() {
        $('a.select_teams_window').css('text-decoration', 'none');
        $(this).css('text-decoration', 'underline');
        $('a.reset_all').click();
        $('#select_by_league_block').css('display', 'block');
    });
    $('a.select_teams_window').on('click', function() {
        $('a.select_league_window').css('text-decoration', 'none');
        $(this).css('text-decoration', 'underline');
        $('#select_by_league_block').css('display', 'none');
        $('select[name=league]').reset(); #TODO reset, TODO pass winter years or summer years to main form
    });

%script
    $('a.reset_all').on('click', function() {
        $('.selected_teams').val('').trigger('chosen');
    });


%script
    var BetterListModel = function () {
        this.itemToAdd = ko.observable("");
        this.allItems = ko.observableArray([]);
        this.selectedItems = ko.observableArray([]);
     
        this.addItem = function () {
            if ((this.itemToAdd() != "") && (this.allItems.indexOf(this.itemToAdd()) < 0))
                this.allItems.push(this.itemToAdd() + ';');
            this.itemToAdd("");
        };

        this.removeAllItems = function () {
            this.allItems.removeAll();
        };
     
        this.removeSelected = function () {
            this.allItems.removeAll(this.selectedItems());
            this.selectedItems([]);
        };
     
        this.sortItems = function() {
            this.allItems.sort();
        };
    };
     
    ko.applyBindings(new BetterListModel());

%script
    $('.summer, .winter').click(function() {
        $('.summer, .winter').css('text-decoration', 'none');
        $('#query').removeAttr('disabled');
        $('#button_team_name').removeAttr('disabled');
        $('#select_teams_button_get').removeAttr('disabled');
        $('#select_teams_button_save').removeAttr('disabled');
        $('a.reset_all').click();
        $(this).css('text-decoration', 'underline');
        var summer_winter = $(this).attr("value");
        $.ajax({
            url: '{{ url_for("autocomplete") }}',
            data: {'summer_winter': summer_winter }
        }).done(function (data) {
            $('#query').autocomplete({
                source: function(request, response) {
                    var results = $.ui.autocomplete.filter(data.json_list, request.term);
                    response(results.slice(0, 10));
                },
                minLength: 2,
            });
        });
    });

%script
    $(document).ready(function() {
        $('a.select_teams_window').click(function() {
            var loginBox = $(this).attr('href');
            $(loginBox).fadeIn(300);
            var popMargTop = ($(loginBox).height() + 24) / 2; 
            var popMargLeft = ($(loginBox).width() + 24) / 2; 
            
            $(loginBox).css({ 
                'margin-top' : -popMargTop,
                'margin-left' : -popMargLeft
            });
            
            $('body').append('<div id="mask"></div>');
            $('#mask').fadeIn(300);
            
            return false;
        });
    });

%script

    ;Used to hide a list of available years
    $(function(){

        $('#mySlideContent').css('display','none');
        $('#mySlideToggler').click(function(){

            if ($('#mySlideContent').css('display') == 'block') {
                $('#mySlideContent').css('display','none');
                return
            };
            $('#mySlideContent').css('display','block');

        });
    });

    $('input[name=varying_value]').attr('disabled', 'disabled');
    $('input[name=number_of_games]').attr('disabled', 'disabled');
    
    $("select[name=group]").change(get_years);
    $("select[name=league]").change(get_groups);
    $("select[name=varying_type]").change(varying_type_change);
    $("#handicap").change(handicap_changed_event);

    $('#searchForm').on('keyup keypress change', search_form_check);

    

    ;Variable templates comes from Flask view and to be able to use it
    ;we need to convert it to JSON object
    {% if templates %}
        var templates = {{ templates|tojson|safe }}
    {% else %}
        var templates = {}
    {% endif %}

%script
        $('#right_side_bar').perfectScrollbar();


{% endhaml %}